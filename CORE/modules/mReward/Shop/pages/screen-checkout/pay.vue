<template>
    <div class="checkout-pay">
        <div class="will-change--helper">
            <v-select
                    v-model="paymentMethod"
                    :items="methods"
                    class="tile-selected"
                    :label="$t('m_shop_payment_methods')"
                    item-text="name"
                    item-value="type"
                    :menu-props="{maxHeight: 400}"
                    @change="$emit('hideError')"
            />

            <div class="checkout-pay__pre-check">
                <div class="checkout-pay__pre-check__title">{{$t('m_shop_payment_amount')}}</div>
                <div class="checkout-pay__pre-check__value">{{totalAmountCart}} c.</div>
            </div>
            <div class="checkout-pay__pre-check">
                <div class="checkout-pay__pre-check__title">{{$t('m_shop_payment_delivery_amount')}}</div>
                <div class="checkout-pay__pre-check__value">{{delivery.price}} c.</div>
            </div>

            <div v-if="paymentMethod !== 'cash'"
                 class="checkout-pay__pre-check">
                <div class="checkout-pay__pre-check__title">
                    {{$t('m_shop_payment_bonuses_to_pay')}}

                    <div class="checkout-pay__pre-check__hint">
                        {{$t('m_shop_payment_available_amount', '', {
                            balance: balanceBonuse.avialable,
                            currency: balanceBonuse.currency,
                            available: 300,
                        })}}
                    </div>
                </div>
                <div class="checkout-pay__pre-check__value">
                    <v-text-field
                            v-model="bonuses"
                            type="text"
                            outlined
                            @focus="$emit('hideError')"
                    />
                </div>
            </div>

            <div class="product-details__devider"/>

            <div class="checkout-pay__pre-check checkout-pay__pre-check--total">
                <div class="checkout-pay__pre-check__title">{{$t('m_shop_payment_amount_to_pay')}}</div>
                <div class="checkout-pay__pre-check__value">{{totalAmount}} c.</div>
            </div>

            <div v-if="paymentMethod === 'cash'"
                 class="delivery__info">
                <div class="delivery__info__icon">
                    <i class="icon-info"/>
                </div>
                <div class="delivery__info__text">
                    Дорогой друг! Спешим сообщить, что при оплате заказа наличными бонусные баллы в мобильном приложении не начисляются. Также, при оплате наличными, нельзя совершить частичную оплату заказа бонусными баллами. Приносим извинения за доставленные неудобства!
                </div>
            </div>
        </div>

        <div class="checkout-pay__btn-pay">
            <v-btn
                    block
                    depressed
                    color="primary"
                    type="main"
                    @click="nextPage"
            >
                {{ $t('m_next') }}
            </v-btn>
        </div>
    </div>
</template>

<script>
    import { mapActions, mapGetters } from 'vuex'
    import constants from '_vuex_constants'
    import InputBase from '_CORE/components/common/inputs/input-base'
    import ScreenStatusPay from '_screen_shop_pay_success'

    export default {
        name: 'checkout-pay',
        components: {InputBase},
        mixins: [
        ],
        data () {
            return {
                errorMessages: {

                },
                bonuses: 0,
                paymentMethod: 'cash',
                methods: [
                    {
                        name: 'Банковская карта',
                        type: 'card',
                    },
                    {
                        name: 'Наличные',
                        type: 'cash',
                    },
                    {
                        name: 'Бонусы',
                        type: 'bonus',
                    }
                ]
            }
        },
        computed: {
            ...mapGetters({
                accounts: constants.MrewardAccount.Getters.accounts,
                deliveryList: constants.MrewardShop.Getters.deliveryList,
                profile: constants.MrewardProfile.Getters.userProfile,
                countries: constants.MrewardGeo.Getters.countries,
                cart: constants.MrewardShop.Getters.cart,
                country: constants.MrewardShop.Getters.country,
            }),
            totalAmountCart() {
                return this.cart.reduce((accumulator, item) => {
                    const total = item.price * item.count
                    return accumulator + total
                }, 0)
            },
            delivery() {
                return this.deliveryList[0] || {}
            },
            totalAmount() {
                return this.totalAmountCart + (this.delivery.price || 0)
            },
            balanceBonuse() {
                const balance = this.accounts.find(i => i.currency === `B${this.country.code}`)
                return balance || {}
            }
        },
        methods: {
            ...mapActions({
                getCountries: constants.MrewardGeo.Actions.getCountries,
                getCityById: constants.MrewardGeo.Actions.getCityById,
                pushPage: constants.App.Actions.pushPage,
                preCheck: constants.MrewardShop.Actions.preCheck,

            }),

            async nextPage() {
                this.$bus.$emit('goToPay', this.paymentMethod, this.bonuses)
                // await this.preCheck({type: paymentMethod})

                // this.pushPage(ScreenStatusPay)
            }
        }
    }
</script>

<style lang="scss">
    .checkout-pay {
        .product-details__devider {
            margin: 12px 0 !important;
        }

        &__pre-check {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;

            &__title {
                font-style: normal;
                font-weight: normal;
                font-size: 13px;
                line-height: 18px;
                letter-spacing: -0.078px;
                color: #000000;
            }

            &__value {
                font-style: normal;
                font-weight: 600;
                font-size: 15px;
                line-height: 20px;
                letter-spacing: -0.24px;
                color: #000000;
            }

            &--total {
                .checkout-pay__pre-check {
                    &__title {
                        font-style: normal;
                        font-weight: 600;
                        font-size: 17px;
                        line-height: 24px;
                        letter-spacing: 0.2px;
                        color: #000000;
                    }
                    &__value {
                        font-style: normal;
                        font-weight: 600;
                        font-size: 17px;
                        line-height: 24px;
                        letter-spacing: 0.2px;
                        color: #6D0978;
                    }
                }
            }

            &__hint {
                font-style: normal;
                font-weight: normal;
                font-size: 12px;
                line-height: 16px;
                color: rgba(60, 60, 67, 0.6);
            }

            .v-text-field--outlined fieldset {
                border: 1px solid #000000;
                box-sizing: border-box;
                border-radius: 8px;
            }

            .v-text-field__slot input {
                font-style: normal;
                font-weight: normal;
                font-size: 15px;
                line-height: 20px;
                text-align: center;
                letter-spacing: -0.24px;
                color: #000000;
            }

            .v-input {
                height: 54px;
                width: 94px;
            }
            .v-text-field--outlined>.v-input__control>.v-input__slot {
                min-height: 49px;
            }
        }

        &__btn-pay {
            margin-top: 16px;
        }
    }
</style>
