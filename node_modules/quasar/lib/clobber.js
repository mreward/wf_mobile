"use strict";

require("earlgrey-runtime/5");var $targ$5 = undefined;var $targ$6 = undefined;var $targ$7 = undefined;var util$0 = undefined;var ID$0 = undefined;var tuck$0 = undefined;var longest__minus__run$0 = undefined;var kaiser$0 = undefined;var object__minus__clobber__minus__helper$0 = undefined;var array__minus__clobber__minus__helper$0 = undefined;var clobber$0 = undefined;util$0 = require("./util");ID$0 = getProperty(util$0, "ID", "util");tuck$0 = getProperty(util$0, "tuck", "util");longest__minus__run$0 = getProperty(util$0, "longestRun", "util");kaiser$0 = require("kaiser");object__minus__clobber__minus__helper$0 = function objectClobberHelper(obj$0, new__minus__obj$0, items$0, owns$0) {
  var m$0 = undefined;var m$1 = undefined;var operations$0 = undefined;operations$0 = [];m$0 = null;$0: for (var _iterator = items$0(obj$0)[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {
    m$0 = _step.value;
    var k$0 = undefined;var v$0 = undefined;var t0$0 = undefined;var t1$0 = undefined;t0$0 = m$0;if (Array.isArray(t0$0) && (t1$0 = t0$0.length, t1$0 === 2 && (k$0 = t0$0[0], v$0 = t0$0[1], !owns$0(new__minus__obj$0, k$0)))) {
      operations$0.push(["delete", k$0]);
    } else {
      false;
    }
  }m$1 = null;$1: for (var _iterator2 = items$0(new__minus__obj$0)[Symbol.iterator](), _step2; !(_step2 = _iterator2.next()).done;) {
    m$1 = _step2.value;
    var v0$0 = undefined;var bridge$$1246$0 = undefined;var k$1 = undefined;var v$1 = undefined;var ph$0$0 = undefined;var t0$1 = undefined;var t1$1 = undefined;var t2$0 = undefined;t0$1 = m$1;if (Array.isArray(t0$1) && (t1$1 = t0$1.length, t1$1 === 2)) {
      k$1 = t0$1[0];t2$0 = t0$1[1];v$1 = t2$0;ph$0$0 = t2$0;v0$0 = send(obj$0, k$1);bridge$$1246$0 = ph$0$0;if (bridge$$1246$0 === v0$0 || v0$0 && send(v0$0, ID$0) && v$1 && equal(send(v$1, ID$0), send(v0$0, ID$0))) {
        undefined;
      } else {
        operations$0.push(["put", k$1, v$1]);
      }
    } else {
      ___match_error(m$1);
    }
  }return operations$0;
};array__minus__clobber__minus__helper$0 = function arrayClobberHelper() {
  var m$3 = undefined;var m$4 = undefined;var acc$0 = undefined;var temp$0 = undefined;var cmp$0 = undefined;var m$5 = undefined;var m$6 = undefined;var m$7 = undefined;var acc$1 = undefined;var temp$3 = undefined;var m$8 = undefined;var idpos$0 = undefined;var indices$0 = undefined;var run$0 = undefined;var newids$0 = undefined;var disposable$0 = undefined;var old__minus__current$0 = undefined;var new__minus__current$0 = undefined;var operations$1 = undefined;var arr$0 = undefined;var new__minus__arr$0 = undefined;var duplicate$0 = undefined;var t0$2 = undefined;var m$2$0 = undefined;m$2$0 = arguments;t0$2 = m$2$0.length;if (t0$2 >= 2 && t0$2 <= 3) {
    arr$0 = m$2$0[0];new__minus__arr$0 = m$2$0[1];if (2 >= t0$2) {
      duplicate$0 = true;
    } else {
      duplicate$0 = m$2$0[2];
    }idpos$0 = {};m$3 = null;$2: for (var _iterator = enumerate(arr$0)[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {
      m$3 = _step.value;
      var $targ$0 = undefined;var id$0 = undefined;var t0$4 = undefined;var t1$3 = undefined;var t2$2 = undefined;var i$0 = undefined;var x$0 = undefined;var ph$1$0 = undefined;var t0$3 = undefined;var t1$2 = undefined;var t2$1 = undefined;t0$3 = m$3;if (Array.isArray(t0$3) && (t1$2 = t0$3.length, t1$2 === 2)) {
        i$0 = t0$3[0];t2$1 = t0$3[1];x$0 = t2$1;ph$1$0 = t2$1;t0$4 = ph$1$0;t1$3 = ID$0;if (___hasprop(t0$4, t1$3) && (t2$2 = send(t0$4, t1$3), typeof t2$2 === "number")) {
          id$0 = t2$2;$targ$0 = [i$0, x$0];idpos$0[id$0] = $targ$0;void 0;
        } else {
          continue $2;
        }
      } else {
        ___match_error(m$3);
      }
    }acc$0 = [];temp$0 = null;m$4 = null;$6: for (var _iterator2 = enumerate(new__minus__arr$0)[Symbol.iterator](), _step2; !(_step2 = _iterator2.next()).done;) {
      m$4 = _step2.value;
      var id$1 = undefined;var t0$6 = undefined;var t1$5 = undefined;var t2$4 = undefined;var i$1 = undefined;var x$1 = undefined;var ph$2$0 = undefined;var t0$5 = undefined;var t1$4 = undefined;var t2$3 = undefined;t0$5 = m$4;if (Array.isArray(t0$5) && (t1$4 = t0$5.length, t1$4 === 2)) {
        i$1 = t0$5[0];t2$3 = t0$5[1];x$1 = t2$3;ph$2$0 = t2$3;t0$6 = ph$2$0;t1$5 = ID$0;if (___hasprop(t0$6, t1$5) && (t2$4 = send(t0$6, t1$5), typeof t2$4 === "number" && (id$1 = t2$4, send(idpos$0, id$1)))) {
          temp$0 = [i$1, send(idpos$0, id$1)[0]];
        } else {
          continue $6;
        }acc$0.push(temp$0);
      } else {
        ___match_error(m$4);
      }
    }indices$0 = acc$0;cmp$0 = function cmp(temp$1$0, temp$2$0) {
      var t0$7 = undefined;var t1$6 = undefined;var t0$8 = undefined;var t1$7 = undefined;var p1$0 = undefined;var p2$0 = undefined;t0$7 = temp$1$0;if (Array.isArray(t0$7) && (t1$6 = t0$7.length, t1$6 === 2)) {
        t0$7[0];p1$0 = t0$7[1];
      } else {
        ___match_error(temp$1$0);
      }t0$8 = temp$2$0;if (Array.isArray(t0$8) && (t1$7 = t0$8.length, t1$7 === 2)) {
        t0$8[0];p2$0 = t0$8[1];
      } else {
        ___match_error(temp$2$0);
      }return p1$0 < p2$0;
    };run$0 = longest__minus__run$0(indices$0, cmp$0, [-1, -1]);newids$0 = {};m$5 = null;$3: for (var _iterator3 = new__minus__arr$0[Symbol.iterator](), _step3; !(_step3 = _iterator3.next()).done;) {
      m$5 = _step3.value;
      var $targ$1 = undefined;var x$2 = undefined;var id$2 = undefined;var t0$9 = undefined;var t1$8 = undefined;var t2$5 = undefined;t0$9 = m$5;x$2 = t0$9;t1$8 = ID$0;if (___hasprop(t0$9, t1$8) && (t2$5 = send(t0$9, t1$8), typeof t2$5 === "number" && (id$2 = t2$5, true))) {
        $targ$1 = true;newids$0[id$2] = $targ$1;void 0;
      } else {
        false;
      }
    }disposable$0 = {};m$6 = null;$4: for (var _iterator4 = arr$0[Symbol.iterator](), _step4; !(_step4 = _iterator4.next()).done;) {
      m$6 = _step4.value;
      var $targ$2 = undefined;var x$3 = undefined;var id$3 = undefined;var t0$10 = undefined;var t1$9 = undefined;var t2$6 = undefined;t0$10 = m$6;x$3 = t0$10;t1$9 = ID$0;if (___hasprop(t0$10, t1$9) && (t2$6 = send(t0$10, t1$9), typeof t2$6 === "number" && (id$3 = t2$6, !send(newids$0, id$3)))) {
        $targ$2 = true;disposable$0[id$3] = $targ$2;void 0;
      } else {
        false;
      }
    }if (duplicate$0) {
      acc$1 = [];temp$3 = null;m$7 = null;$7: for (var _iterator5 = run$0[Symbol.iterator](), _step5; !(_step5 = _iterator5.next()).done;) {
        m$7 = _step5.value;
        var new__minus__i$0 = undefined;var old__minus__i$0 = undefined;var t0$11 = undefined;var t1$10 = undefined;t0$11 = m$7;if (Array.isArray(t0$11) && (t1$10 = t0$11.length, t1$10 === 2)) {
          new__minus__i$0 = t0$11[0];old__minus__i$0 = t0$11[1];if (send(arr$0, old__minus__i$0) && send(send(arr$0, old__minus__i$0, true), ID$0)) {
            delete idpos$0[send(send(arr$0, old__minus__i$0, true), ID$0)];
          }acc$1.push(temp$3);
        } else {
          ___match_error(m$7);
        }
      }acc$1;
    }run$0.push([new__minus__arr$0.length, arr$0.length]);old__minus__current$0 = 0;new__minus__current$0 = 0;operations$1 = [];m$8 = null;$5: for (var _iterator6 = run$0[Symbol.iterator](), _step6; !(_step6 = _iterator6.next()).done;) {
      m$8 = _step6.value;
      var m$10 = undefined;var acc$2 = undefined;var temp$4 = undefined;var n$0 = undefined;var fresh$0 = undefined;var inserts$0 = undefined;var new__minus__i$1 = undefined;var old__minus__i$1 = undefined;var t0$12 = undefined;var t1$11 = undefined;t0$12 = m$8;if (Array.isArray(t0$12) && (t1$11 = t0$12.length, t1$11 === 2)) {
        new__minus__i$1 = t0$12[0];old__minus__i$1 = t0$12[1];n$0 = old__minus__i$1 - old__minus__current$0;fresh$0 = new__minus__arr$0.slice(new__minus__current$0, new__minus__i$1);$8: while (n$0 > 0 && old__minus__current$0 < old__minus__i$1 && fresh$0.length > 0) {
          var bridge$$1655$0 = undefined;var bridge$$1654$0 = undefined;var bridge$$1653$0 = undefined;var bridge$$1652$0 = undefined;var id$4 = undefined;var bridge$$1651$0 = undefined;var t0$13 = undefined;var t1$12 = undefined;var m$9$0 = undefined;m$9$0 = send(arr$0, old__minus__current$0);bridge$$1651$0 = m$9$0;if ((bridge$$1652$0 = bridge$$1651$0, (bridge$$1653$0 = bridge$$1652$0, (bridge$$1654$0 = bridge$$1653$0, (bridge$$1655$0 = bridge$$1654$0, bridge$$1655$0 === null || bridge$$1655$0 === void 0) || typeof bridge$$1654$0 === "string") || typeof bridge$$1653$0 === "number") || typeof bridge$$1652$0 === "boolean") || typeof bridge$$1651$0 === "function") {
            operations$1.push(["clobber", new__minus__current$0, fresh$0.shift()]);old__minus__current$0 = old__minus__current$0 + 1;new__minus__current$0 = new__minus__current$0 + 1;n$0 = n$0 - 1;
          } else {
            t0$13 = ID$0;if (___hasprop(m$9$0, t0$13) && (t1$12 = send(m$9$0, t0$13), typeof t1$12 === "number" && (id$4 = t1$12, send(disposable$0, id$4)))) {
              operations$1.push(["clobber", new__minus__current$0, fresh$0.shift()]);old__minus__current$0 = old__minus__current$0 + 1;new__minus__current$0 = new__minus__current$0 + 1;n$0 = n$0 - 1;
            } else {
              break $8;
            }
          }
        }acc$2 = [];temp$4 = null;m$10 = null;$9: for (var _iterator7 = fresh$0[Symbol.iterator](), _step7; !(_step7 = _iterator7.next()).done;) {
          m$10 = _step7.value;
          var entry$1 = undefined;var entry$0 = undefined;var orig$0 = undefined;var t0$14 = undefined;var t1$13 = undefined;var t2$7 = undefined;t0$14 = m$10;entry$0 = t0$14;t1$13 = send(idpos$0, send(entry$0, ID$0) || -1);if (Array.isArray(t1$13) && (t2$7 = t1$13.length, t2$7 === 2 && (t1$13[0], orig$0 = t1$13[1], entry$0 && duplicate$0))) {
            delete idpos$0[send(entry$0, ID$0)];temp$4 = ["keep", orig$0];acc$2.push(temp$4);
          } else {
            entry$1 = m$10;temp$4 = ["acquire", entry$1];acc$2.push(temp$4);
          }
        }inserts$0 = acc$2;operations$1.push(["splice", new__minus__current$0, n$0, inserts$0]);old__minus__current$0 = old__minus__i$1 + 1;new__minus__current$0 = new__minus__i$1 + 1;new__minus__current$0;
      } else {
        ___match_error(m$8);
      }
    }return operations$1;
  } else {
    return ___match_error(m$2$0, "{arr, new-arr, duplicate = true}");
  }
};clobber$0 = function clobber(old__minus__value$0, new__minus__value$0, dir$0) {
  var bridge$$1788$0 = undefined;var bridge$$1787$0 = undefined;var bridge$$1786$0 = undefined;var bridge$$1785$0 = undefined;var bridge$$1784$0 = undefined;var m$11$0 = undefined;var m$13 = undefined;var m$16 = undefined;var acc$4 = undefined;var temp$6 = undefined;var exits$0 = undefined;var keeps$0 = undefined;var m$17 = undefined;var acc$5 = undefined;var temp$7 = undefined;var m$12$0 = undefined;var h1$0 = undefined;var h2$0 = undefined;var o1$0 = undefined;var o2$0 = undefined;m$11$0 = old__minus__value$0;bridge$$1784$0 = m$11$0;if ((bridge$$1785$0 = bridge$$1784$0, (bridge$$1786$0 = bridge$$1785$0, (bridge$$1787$0 = bridge$$1786$0, (bridge$$1788$0 = bridge$$1787$0, bridge$$1788$0 === null || bridge$$1788$0 === void 0) || typeof bridge$$1787$0 === "string") || typeof bridge$$1786$0 === "number") || typeof bridge$$1785$0 === "boolean") || getChecker(Symbol)(bridge$$1784$0)) {
    return new__minus__value$0;
  } else {
    undefined;
  }h1$0 = kaiser$0.getHandler(old__minus__value$0);h2$0 = kaiser$0.getHandler(new__minus__value$0);if (h1$0 !== h2$0) {
    return dir$0.replace(old__minus__value$0, new__minus__value$0, false);
  }dir$0.unlist(old__minus__value$0);o1$0 = h1$0.serialize(old__minus__value$0);o2$0 = h2$0.serialize(new__minus__value$0);m$12$0 = o1$0;if (Array.isArray(m$12$0)) {
    exits$0 = new Set();keeps$0 = new Set();m$13 = null;$10: for (var _iterator = array__minus__clobber__minus__helper$0(o1$0, o2$0, dir$0.duplicate)[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {
      m$13 = _step.value;
      var $targ$3 = undefined;var m$14 = undefined;var m$15 = undefined;var acc$3 = undefined;var temp$5 = undefined;var acquired$0 = undefined;var start$0 = undefined;var n$1 = undefined;var inserts$1 = undefined;var i$2 = undefined;var value$0 = undefined;var $$1865$0 = undefined;var $$1866$0 = undefined;var $$1867$0 = undefined;var t0$15 = undefined;var t1$14 = undefined;t0$15 = m$13;if (($$1866$0 = Array.isArray(t0$15)) && (t1$14 = t0$15.length, t1$14 === 3 && t0$15[0] === "clobber")) {
        i$2 = t0$15[1];value$0 = t0$15[2];$targ$3 = dir$0.clobber(send(o1$0, i$2), value$0);o1$0[i$2] = $targ$3;void 0;
      } else {
        if ($$1866$0 && (t1$14 === 4 && t0$15[0] === "splice")) {
          start$0 = t0$15[1];n$1 = t0$15[2];inserts$1 = t0$15[3];m$14 = null;$12: for (var _iterator2 = range(start$0, start$0 + n$1)[Symbol.iterator](), _step2; !(_step2 = _iterator2.next()).done;) {
            m$14 = _step2.value;
            var i$3 = undefined;i$3 = m$14;exits$0.add(send(o1$0, i$3));
          }acc$3 = [];temp$5 = null;m$15 = null;$13: for (var _iterator3 = inserts$1[Symbol.iterator](), _step3; !(_step3 = _iterator3.next()).done;) {
            m$15 = _step3.value;
            var x$5 = undefined;var x$4 = undefined;var $$1919$0 = undefined;var $$1920$0 = undefined;var $$1921$0 = undefined;var $$1922$0 = undefined;var t0$16 = undefined;var t1$15 = undefined;t0$16 = m$15;if (($$1920$0 = Array.isArray(t0$16)) && (t1$15 = t0$16.length, ($$1922$0 = t1$15 === 2) && t0$16[0] === "keep")) {
              x$4 = t0$16[1];keeps$0.add(x$4);temp$5 = x$4;acc$3.push(temp$5);
            } else {
              if ($$1922$0 && t0$16[0] === "acquire") {
                x$5 = t0$16[1];temp$5 = dir$0.acquire(x$5);acc$3.push(temp$5);
              } else {
                ___match_error(m$15);
              }
            }
          }acquired$0 = acc$3;send(send(o1$0, "splice", true), [start$0, n$1].concat(acquired$0));
        } else {
          ___match_error(m$13);
        }
      }
    }acc$4 = [];temp$6 = null;m$16 = null;$11: for (var _iterator4 = exits$0[Symbol.iterator](), _step4; !(_step4 = _iterator4.next()).done;) {
      m$16 = _step4.value;
      var x$6 = undefined;x$6 = m$16;if (!keeps$0.has(x$6)) {
        temp$6 = dir$0.exit(x$6);acc$4.push(temp$6);
      } else {
        false;
      }
    }acc$4;
  } else {
    acc$5 = [];temp$7 = null;m$17 = null;$14: for (var _iterator5 = object__minus__clobber__minus__helper$0(o1$0, o2$0, items, function (a$0, b$0) {
      return Object.hasOwnProperty.call(a$0, b$0);
    })[Symbol.iterator](), _step5; !(_step5 = _iterator5.next()).done;) {
      m$17 = _step5.value;
      var $targ$4 = undefined;var k$3 = undefined;var v$2 = undefined;var k$2 = undefined;var $$2000$0 = undefined;var $$2001$0 = undefined;var $$2002$0 = undefined;var t0$17 = undefined;var t1$16 = undefined;t0$17 = m$17;if (($$2001$0 = Array.isArray(t0$17)) && (t1$16 = t0$17.length, t1$16 === 2 && t0$17[0] === "delete")) {
        k$2 = t0$17[1];dir$0.exit(send(o1$0, k$2));delete o1$0[k$2];acc$5.push(temp$7);
      } else {
        if ($$2001$0 && (t1$16 === 3 && t0$17[0] === "put")) {
          k$3 = t0$17[1];v$2 = t0$17[2];$targ$4 = dir$0.clobber(send(o1$0, k$3), v$2);o1$0[k$3] = $targ$4;temp$7 = void 0;acc$5.push(temp$7);
        } else {
          ___match_error(m$17);
        }
      }
    }acc$5;
  }h1$0.fill(old__minus__value$0, o1$0);tuck$0(old__minus__value$0, ID$0, send(new__minus__value$0, ID$0));dir$0.list(old__minus__value$0);return old__minus__value$0;
};$targ$5 = clobber$0;exports.clobber = $targ$5;$targ$6 = array__minus__clobber__minus__helper$0;exports.arrayClobberHelper = $targ$6;$targ$7 = object__minus__clobber__minus__helper$0;exports.objectClobberHelper = $targ$7;void 0;
//# sourceMappingURL=clobber.js.map

